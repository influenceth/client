diff --git a/node_modules/three/examples/jsm/csm/CSM.js b/node_modules/three/examples/jsm/csm/CSM.js
index c96e627..f1398b2 100644
--- a/node_modules/three/examples/jsm/csm/CSM.js
+++ b/node_modules/three/examples/jsm/csm/CSM.js
@@ -30,6 +30,7 @@ export class CSM {
 		this.mode = data.mode || 'practical';
 		this.shadowMapSize = data.shadowMapSize || 2048;
 		this.shadowBias = data.shadowBias || 0.000001;
+		this.lightColor = data.lightColor || 0xffffff;
 		this.lightDirection = data.lightDirection || new Vector3( 1, - 1, 1 ).normalize();
 		this.lightIntensity = data.lightIntensity || 1;
 		this.lightNear = data.lightNear || 1;
@@ -54,7 +55,7 @@ export class CSM {
 
 		for ( let i = 0; i < this.cascades; i ++ ) {
 
-			const light = new DirectionalLight( 0xffffff, this.lightIntensity );
+			const light = new DirectionalLight( this.lightColor, this.lightIntensity );
 			light.castShadow = true;
 			light.shadow.mapSize.width = this.shadowMapSize;
 			light.shadow.mapSize.height = this.shadowMapSize;
@@ -244,7 +245,7 @@ export class CSM {
 
 	}
 
-	setupMaterial( material ) {
+	setupMaterial( material, preexistingOnBeforeCompile ) {
 
 		material.defines = material.defines || {};
 		material.defines.USE_CSM = 1;
@@ -260,7 +261,11 @@ export class CSM {
 		const scope = this;
 		const shaders = this.shaders;
 
+		material.userData.preexistingOnBeforeCompile = preexistingOnBeforeCompile;
 		material.onBeforeCompile = function ( shader ) {
+			if (preexistingOnBeforeCompile) {
+				preexistingOnBeforeCompile(shader);
+			}
 
 			const far = Math.min( scope.camera.far, scope.maxFar );
 			scope.getExtendedBreaks( breaksVec2 );
@@ -354,7 +359,11 @@ export class CSM {
 		const shaders = this.shaders;
 		shaders.forEach( function ( shader, material ) {
 
-			delete material.onBeforeCompile;
+			if (material.userData.preexistingOnBeforeCompile) {
+				material.onBeforeCompile = material.userData.preexistingOnBeforeCompile;
+			} else {
+				delete material.onBeforeCompile;
+			}
 			delete material.defines.USE_CSM;
 			delete material.defines.CSM_CASCADES;
 			delete material.defines.CSM_FADE;
